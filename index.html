<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sistema de Gestión Documental</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f2f4f8;
  margin:0;
}
header{
  background:#1f2937;
  color:#fff;
  padding:10px 15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
button{
  padding:6px 10px;
  cursor:pointer;
}
input,textarea,select{
  width:100%;
  padding:6px;
  margin:4px 0;
}
.container{
  padding:15px;
}
.card{
  background:#fff;
  padding:12px;
  margin-bottom:12px;
  border-radius:5px;
}
.hidden{display:none;}
nav button{margin-right:5px;}
</style>
</head>

<body>

<header>
  <strong>Sistema de Gestión Documental</strong>
  <div id="headerUser" class="hidden">
    <span id="userLabel"></span>
    <button onclick="logout()">Salir</button>
  </div>
</header>

<!-- LOGIN -->
<div id="login" class="container">
  <div class="card">
    <h3>Iniciar Sesión</h3>
    <input id="loginUser" placeholder="Usuario">
    <input id="loginPass" type="password" placeholder="Contraseña">
    <button onclick="login()">Ingresar</button>
    <p id="loginError" style="color:red;"></p>
  </div>
</div>

<!-- APP -->
<div id="app" class="container hidden">

  <nav>
    <button onclick="showTab('solicitudes')">Solicitudes</button>
    <button onclick="showTab('nueva')">Nueva Solicitud</button>
    <button id="adminBtn" onclick="showTab('admin')" class="hidden">Administración</button>
  </nav>

  <!-- SOLICITUDES -->
  <div id="solicitudes" class="card hidden">
    <h3>Solicitudes</h3>
    <div id="listaSolicitudes"></div>
  </div>

  <!-- NUEVA -->
  <div id="nueva" class="card hidden">
    <h3>Nueva Solicitud</h3>
    <form onsubmit="crearSolicitud(event)">
      <input id="titulo" placeholder="Título" required>
      <textarea id="descripcion" placeholder="Descripción" required></textarea>
      <button>Crear</button>
    </form>
  </div>

  <!-- ADMIN -->
  <div id="admin" class="card hidden">
    <h3>Panel Administrador</h3>
    <p>Solo visible para admin</p>
  </div>

</div>

<script>
// ================= FIREBASE =================
firebase.initializeApp({
  apiKey: "AIzaSyDdzCiachuhbE9jATz-TesPI2vUVIJrHjM",
  authDomain: "sistemadegestion-7400d.firebaseapp.com",
  projectId: "sistemadegestion-7400d",
});
const db = firebase.firestore();

// ================= USUARIOS =================
const USERS = {
  admin:{pass:"123456", role:"admin"},
  usuario:{pass:"123456", role:"user"}
};

let currentUser = null;
let role = null;

// ================= LOGIN =================
function login(){
  const u = loginUser.value;
  const p = loginPass.value;

  if(!USERS[u] || USERS[u].pass !== p){
    loginError.innerText = "Credenciales incorrectas";
    return;
  }

  currentUser = u;
  role = USERS[u].role;

  document.getElementById("login").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");
  document.getElementById("headerUser").classList.remove("hidden");
  userLabel.innerText = `${u} (${role})`;
  adminBtn.classList.toggle("hidden", role!=="admin");

  showTab("solicitudes");
  cargarSolicitudes();
}

// ================= LOGOUT =================
function logout(){
  location.reload();
}

// ================= TABS =================
function showTab(id){
  ["solicitudes","nueva","admin"].forEach(t=>{
    document.getElementById(t).classList.add("hidden");
  });
  document.getElementById(id).classList.remove("hidden");
}

// ================= SOLICITUDES =================
function crearSolicitud(e){
  e.preventDefault();
  db.collection("solicitudes").add({
    titulo:titulo.value,
    descripcion:descripcion.value,
    usuario:currentUser,
    fecha:new Date()
  });
  titulo.value="";
  descripcion.value="";
  cargarSolicitudes();
  showTab("solicitudes");
}

function cargarSolicitudes(){
  listaSolicitudes.innerHTML="Cargando...";
  db.collection("solicitudes").orderBy("fecha","desc").onSnapshot(snap=>{
    listaSolicitudes.innerHTML="";
    snap.forEach(doc=>{
      const d = doc.data();
      listaSolicitudes.innerHTML+=`
        <div class="card">
          <strong>${d.titulo}</strong>
          <p>${d.descripcion}</p>
          <small>${d.usuario}</small>
        </div>`;
    });
  });
}
</script>

</body>
</html>