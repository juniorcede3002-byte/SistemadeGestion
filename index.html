<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FCI - SGD</title>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    :root {
        --primary: #5c67f2;
        --primary-light: #eef0ff;
        --secondary: #718096;
        --bg: #f8fafc;
        --sidebar: #ffffff;
        --card: #ffffff;
        --text: #2d3748;
        --accent: #f6ad55;
        --danger: #fc8181;
        --success: #68d391;
    }

    body { 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        margin: 0; 
        background: var(--bg); 
        color: var(--text);
        display: flex;
        min-height: 100vh;
    }

    /* LOGIN ESTILO MODERNO */
    #login-div {
        position: fixed;
        inset: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        padding: 20px;
    }

    .login-card {
        background: rgba(255, 255, 255, 0.95);
        padding: 40px;
        border-radius: 24px;
        box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2);
        width: 100%;
        max-width: 380px;
        text-align: center;
    }

    /* SIDEBAR (Inspirado en tu imagen) */
    .sidebar {
        width: 260px;
        background: var(--sidebar);
        border-right: 1px solid #e2e8f0;
        display: flex;
        flex-direction: column;
        padding: 20px 0;
        transition: all 0.3s;
    }

    .brand {
        padding: 0 25px 30px;
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 1.4rem;
        font-weight: bold;
        color: var(--primary);
    }

    .nav-item {
        padding: 14px 25px;
        display: flex;
        align-items: center;
        gap: 15px;
        color: var(--secondary);
        text-decoration: none;
        cursor: pointer;
        transition: 0.2s;
        border-right: 4px solid transparent;
        font-weight: 500;
    }

    .nav-item:hover {
        background: var(--primary-light);
        color: var(--primary);
    }

    .nav-item.active {
        background: var(--primary-light);
        color: var(--primary);
        border-right-color: var(--primary);
    }

    .logout-btn {
        margin-top: auto;
        color: var(--danger);
        border: none;
        background: transparent;
        justify-content: flex-start;
    }

    /* CONTENIDO PRINCIPAL */
    .main-content {
        flex: 1;
        padding: 30px;
        overflow-y: auto;
    }

    .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
    }

    /* CARDS ESTILO DASHBOARD */
    .card-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: var(--card);
        padding: 25px;
        border-radius: 24px;
        box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        border: 1px solid #edf2f7;
    }

    .stat-card span { color: var(--secondary); font-size: 0.8rem; font-weight: bold; text-transform: uppercase; }
    .stat-card h2 { margin: 10px 0 0; font-size: 2rem; color: var(--primary); }

    /* TABLAS Y FORMULARIOS */
    .tab { 
        display: none; 
        background: var(--card); 
        padding: 25px; 
        border-radius: 24px; 
        box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05);
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    input, select {
        width: 100%;
        padding: 12px 15px;
        margin: 8px 0;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        box-sizing: border-box;
        font-size: 14px;
        outline: none;
    }

    input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-light); }

    button {
        background: var(--primary);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 12px;
        font-weight: 600;
        transition: 0.3s;
        margin: 5px 0;
    }

    button:hover { opacity: 0.9; transform: translateY(-1px); }

    table { width: 100%; border-collapse: separate; border-spacing: 0 8px; margin-top: 20px; }
    th { padding: 15px; color: var(--secondary); font-size: 0.85rem; text-align: left; }
    td { padding: 15px; background: #fcfcfc; border-top: 1px solid #f1f5f9; border-bottom: 1px solid #f1f5f9; }
    td:first-child { border-left: 1px solid #f1f5f9; border-radius: 12px 0 0 12px; }
    td:last-child { border-right: 1px solid #f1f5f9; border-radius: 0 12px 12px 0; }

    .status {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
    }
    .status-pendiente { background: #fffaf0; color: #c05621; }

    /* RESPONSIVO */
    @media (max-width: 768px) {
        body { flex-direction: column; }
        .sidebar { width: 100%; padding: 10px 0; }
        .nav-item { padding: 10px 20px; }
    }
</style>
</head>
<body>

<div id="login-div">
    <div class="login-card">
        <div class="brand" style="justify-content: center; padding-bottom: 10px;">
            üóÇÔ∏è <span>FCI - SGD</span>
        </div>
        <p style="color: var(--secondary); margin-bottom: 30px;">Identif√≠cate para continuar</p>
        <input type="text" id="loginUser" placeholder="Usuario">
        <input type="password" id="loginPass" placeholder="Contrase√±a">
        <button style="width: 100%; margin-top: 15px;" onclick="login()">Ingresar al Sistema</button>
        <p id="loginMsg" style="font-size: 13px; margin-top: 15px;"></p>
    </div>
</div>

<div id="dashboard" style="display:none; width: 100%; display: flex;">
    
    <nav class="sidebar">
        <div class="brand">üì¶ InsuManager</div>
        <div class="nav-item active" onclick="abrirTab('dashboard-home'); toggleActive(this)">
            <i class="fa-solid fa-chart-line"></i> Dashboard
        </div>
        <div class="nav-item" onclick="abrirTab('solicitudes-tab'); toggleActive(this)">
            <i class="fa-solid fa-bell"></i> Pendientes
        </div>
        <div class="nav-item" onclick="abrirTab('nueva-solicitud-tab'); toggleActive(this)">
            <i class="fa-solid fa-plus-circle"></i> Nueva Solicitud
        </div>
        <div class="nav-item" onclick="abrirTab('usuarios-tab'); toggleActive(this)">
            <i class="fa-solid fa-users"></i> Usuarios
        </div>
        <div class="nav-item" onclick="abrirTab('gerencias-tab'); toggleActive(this)">
            <i class="fa-solid fa-building"></i> Gerencias
        </div>
        <div class="nav-item" onclick="abrirTab('departamentos-tab'); toggleActive(this)">
            <i class="fa-solid fa-sitemap"></i> Departamentos
        </div>
        
        <button class="nav-item logout-btn" onclick="location.reload()">
            <i class="fa-solid fa-right-from-bracket"></i> Cerrar Sesi√≥n
        </button>
    </nav>

    <main class="main-content">
        <div class="top-bar">
            <h2 id="tab-title">Resumen General</h2>
            <div style="font-weight: 600;">FCILog <i class="fa-solid fa-bars" style="margin-left: 15px; color: var(--primary);"></i></div>
        </div>

        <div id="dashboard-home" class="tab" style="display: block; background: transparent; box-shadow: none; padding: 0;">
            <div class="card-stats">
                <div class="stat-card">
                    <span>Items √önicos</span>
                    <h2 id="count-items">2</h2>
                </div>
                <div class="stat-card">
                    <span>Stock Global</span>
                    <h2 id="count-stock">0</h2>
                </div>
                <div class="stat-card">
                    <span>Pendientes</span>
                    <h2 style="color: var(--accent);">0</h2>
                </div>
            </div>
            
            <div class="card" style="background: white; padding: 30px; border-radius: 24px;">
                <h3>Actividad Reciente</h3>
                <p style="color: var(--secondary);">Gr√°fico de consumo semanal</p>
                <div style="height: 150px; border-bottom: 2px solid #f1f5f9; display: flex; align-items: flex-end; gap: 20px; padding-bottom: 10px;">
                    <div style="flex: 1; background: var(--primary-light); height: 20%;"></div>
                    <div style="flex: 1; background: var(--primary-light); height: 40%;"></div>
                    <div style="flex: 1; background: var(--primary); height: 80%;"></div>
                    <div style="flex: 1; background: var(--primary-light); height: 30%;"></div>
                </div>
            </div>
        </div>

        <div id="usuarios-tab" class="tab">
            <h3>Gesti√≥n de Usuarios</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <input type="text" id="userNombre" placeholder="Nombre completo">
                <input type="text" id="userPass" placeholder="Contrase√±a">
                <input type="email" id="userCorreo" placeholder="Correo electr√≥nico">
                <select id="userRol">
                    <option value="Usuario">Rol: Usuario</option>
                    <option value="Gerente">Rol: Gerente</option>
                    <option value="Admin">Rol: Admin</option>
                </select>
            </div>
            <div style="margin: 15px 0; display: flex; flex-wrap: wrap; gap: 15px; font-size: 13px;">
                <label><input type="checkbox" id="permSolicitudes"> Crear Solicitudes</label>
                <label><input type="checkbox" id="permVerPropias"> Ver Propias</label>
                <label><input type="checkbox" id="permVerGerencia"> Ver Gerencia</label>
                <label><input type="checkbox" id="permAprobar"> Aprobar</label>
                <label><input type="checkbox" id="permGestionUsuarios"> Gestionar Usuarios</label>
            </div>
            <button onclick="crearUsuario()"><i class="fa-solid fa-plus"></i> Registrar Usuario</button>
            <table id="tablaUsuarios"><thead><tr><th>Nombre</th><th>Rol</th><th>Opciones</th></tr></thead><tbody></tbody></table>
        </div>

        <div id="gerencias-tab" class="tab">
            <h3>Gerencias</h3>
            <div style="display:flex; gap:10px;">
                <input type="text" id="gerenciaNombre" placeholder="Nombre Gerencia">
                <button onclick="crearGerencia()">Guardar</button>
            </div>
            <table id="tablaGerencias"><thead><tr><th>Nombre</th><th>Opciones</th></tr></thead><tbody></tbody></table>
        </div>

        <div id="departamentos-tab" class="tab">
            <h3>Departamentos</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr auto; gap:10px;">
                <input type="text" id="departamentoNombre" placeholder="Nombre Departamento">
                <select id="depGerenciaSelect"></select>
                <button onclick="crearDepartamento()">A√±adir</button>
            </div>
            <table id="tablaDepartamentos"><thead><tr><th>Nombre</th><th>Gerencia</th><th>Opciones</th></tr></thead><tbody></tbody></table>
        </div>

        <div id="solicitudes-tab" class="tab">
            <h3>Bandeja de Solicitudes</h3>
            <table id="tablaSolicitudes">
                <thead>
                    <tr>
                        <th>Documento</th><th>Tipo</th><th>Gerencia</th><th>Estado</th><th>Solicitante</th><th>Opciones</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div id="nueva-solicitud-tab" class="tab">
            <h3>Nueva Solicitud</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <label>Nombre del Documento</label>
                    <input type="text" id="solNombre" placeholder="Ej: Manual de Calidad">
                    <label>Tipo</label>
                    <select id="solTipo">
                        <option value="Procedimiento">Procedimiento</option>
                        <option value="Gu√≠a">Gu√≠a</option>
                        <option value="Instructivo">Instructivo</option>
                    </select>
                    <label>Acci√≥n</label>
                    <select id="solAccion">
                        <option value="Creaci√≥n">Creaci√≥n</option>
                        <option value="Modificaci√≥n">Modificaci√≥n</option>
                    </select>
                </div>
                <div>
                    <label>Gerencia</label>
                    <select id="solGerencia"></select>
                    <label>Departamento</label>
                    <select id="solDepartamento"></select>
                    <label>Codificaci√≥n</label>
                    <input type="text" id="solCodigo" placeholder="FCI-001">
                </div>
            </div>
            <label>Motivo del cambio</label>
            <input type="text" id="solMotivo" placeholder="Describa brevemente...">
            <button style="width: 100%; height: 50px; font-size: 1rem;" onclick="crearSolicitud()">Enviar Solicitud</button>
        </div>

    </main>
</div>

<script>
// --- TU L√ìGICA DE FIREBASE SE MANTIENE IGUAL ---
const firebaseConfig = {
  apiKey: "AIzaSyDdzCiachuhbE9jATz-TesPI2vUVIJrHjM",
  authDomain: "sistemadegestion-7400d.firebaseapp.com",
  projectId: "sistemadegestion-7400d",
  storageBucket: "sistemadegestion-7400d.firebasestorage.app",
  messagingSenderId: "709030283072",
  appId: "1:709030283072:web:5997837b36a448e9515ca5"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let currentUser = null;
const usuariosSistema = [{usuario:"Admin",pass:"1130",rol:"Admin"}];

function login(){
  const u = document.getElementById("loginUser").value;
  const p = document.getElementById("loginPass").value;
  const found = usuariosSistema.find(x=>x.usuario===u && x.pass===p);
  if(found){
    currentUser = found;
    document.getElementById("login-div").style.display="none";
    document.getElementById("dashboard").style.display="flex";
    cargarUsuarios(); cargarGerencias(); cargarDepartamentos(); cargarSolicitudes(); cargarGerenciasSolicitudes(); cargarDepartamentosSolicitudes();
  } else {
    document.getElementById("loginMsg").innerText="Usuario o contrase√±a incorrectos";
    document.getElementById("loginMsg").style.color = "red";
  }
}

function abrirTab(tabId){
  document.querySelectorAll(".tab").forEach(t=>t.style.display="none");
  document.getElementById(tabId).style.display="block";
  
  // Cambiar t√≠tulo superior seg√∫n el tab
  const titles = {
      'dashboard-home': 'Resumen General',
      'usuarios-tab': 'Configuraci√≥n de Usuarios',
      'gerencias-tab': 'Gerencias del Sistema',
      'departamentos-tab': 'Departamentos',
      'solicitudes-tab': 'Solicitudes Pendientes',
      'nueva-solicitud-tab': 'Crear Solicitud'
  };
  document.getElementById('tab-title').innerText = titles[tabId] || 'Panel';
}

function toggleActive(element) {
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    element.classList.add('active');
}

// --- TODAS LAS DEM√ÅS FUNCIONES SON ID√âNTICAS A TU C√ìDIGO ---

async function crearUsuario(){
  const nombre = document.getElementById("userNombre").value;
  const pass = document.getElementById("userPass").value;
  const correo = document.getElementById("userCorreo").value;
  const rol = document.getElementById("userRol").value;
  const permisos = {
    solicitudes: document.getElementById("permSolicitudes").checked,
    verPropias: document.getElementById("permVerPropias").checked,
    verGerencia: document.getElementById("permVerGerencia").checked,
    aprobar: document.getElementById("permAprobar").checked,
    gestionar: document.getElementById("permGestionUsuarios").checked
  };
  await db.collection("usuarios").add({nombre, pass, correo, rol, permisos});
  cargarUsuarios();
}

async function cargarUsuarios(){
  const tbody = document.querySelector("#tablaUsuarios tbody");
  tbody.innerHTML="";
  const snapshot = await db.collection("usuarios").get();
  snapshot.forEach(doc=>{
    const d = doc.data();
    tbody.innerHTML += `<tr>
      <td><b>${d.nombre}</b></td><td>${d.rol}</td>
      <td>
        <button style="background:var(--secondary); padding: 5px 10px" onclick="editarUsuario('${doc.id}')"><i class="fa-solid fa-pen"></i></button>
        <button style="background:var(--danger); padding: 5px 10px" onclick="eliminarUsuario('${doc.id}')"><i class="fa-solid fa-trash"></i></button>
      </td>
    </tr>`;
  });
}

async function eliminarUsuario(id){ await db.collection("usuarios").doc(id).delete(); cargarUsuarios(); }
function editarUsuario(id){ alert("Funci√≥n editar usuario pendiente"); }

async function crearGerencia(){
  const nombre = document.getElementById("gerenciaNombre").value;
  await db.collection("gerencias").add({nombre});
  cargarGerencias();
  cargarGerenciasSolicitudes();
}

async function cargarGerencias(){
  const tbody = document.querySelector("#tablaGerencias tbody");
  tbody.innerHTML="";
  const snapshot = await db.collection("gerencias").get();
  snapshot.forEach(doc=>{
    const d = doc.data();
    tbody.innerHTML += `<tr><td>${d.nombre}</td><td><button style="background:var(--danger)" onclick="eliminarGerencia('${doc.id}')">Eliminar</button></td></tr>`;
  });
}

async function eliminarGerencia(id){ await db.collection("gerencias").doc(id).delete(); cargarGerencias(); cargarGerenciasSolicitudes(); }

async function crearDepartamento(){
  const nombre = document.getElementById("departamentoNombre").value;
  const gerencia = document.getElementById("depGerenciaSelect").value;
  await db.collection("departamentos").add({nombre, gerencia});
  cargarDepartamentos();
  cargarDepartamentosSolicitudes();
}

async function cargarDepartamentos(){
  const tbody = document.querySelector("#tablaDepartamentos tbody");
  tbody.innerHTML="";
  const snapshot = await db.collection("departamentos").get();
  snapshot.forEach(doc=>{
    const d = doc.data();
    tbody.innerHTML += `<tr><td>${d.nombre}</td><td>${d.gerencia}</td><td><button style="background:var(--danger)" onclick="eliminarDepartamento('${doc.id}')">Eliminar</button></td></tr>`;
  });
}

async function eliminarDepartamento(id){ await db.collection("departamentos").doc(id).delete(); cargarDepartamentos(); cargarDepartamentosSolicitudes(); }

async function cargarSolicitudes(){
  const tbody = document.querySelector("#tablaSolicitudes tbody");
  tbody.innerHTML="";
  const snapshot = await db.collection("solicitudes").get();
  snapshot.forEach(doc=>{
    const d = doc.data();
    tbody.innerHTML += `<tr>
      <td><b>${d.nombreDocumento}</b></td>
      <td>${d.tipo}</td>
      <td>${d.gerencia}</td>
      <td><span class="status status-pendiente">${d.estado}</span></td>
      <td>${d.usuario}</td>
      <td><button onclick="verDetalle('${doc.id}')">Ver</button></td>
    </tr>`;
  });
}

function verDetalle(id){ alert("Funci√≥n ver detalle pendiente: "+id); }

async function crearSolicitud(){
  const solicitud = {
    nombreDocumento: document.getElementById("solNombre").value,
    tipo: document.getElementById("solTipo").value,
    accion: document.getElementById("solAccion").value,
    gerencia: document.getElementById("solGerencia").value,
    departamento: document.getElementById("solDepartamento").value,
    motivo: document.getElementById("solMotivo").value,
    ultimaVersion: document.getElementById("solUltimaVersion") ? document.getElementById("solUltimaVersion").value : "",
    fechaUltima: document.getElementById("solFechaUltima") ? document.getElementById("solFechaUltima").value : "",
    codificacion: document.getElementById("solCodigo").value,
    estado: "Pendiente",
    usuario: currentUser.usuario
  };
  await db.collection("solicitudes").add(solicitud);
  alert("Solicitud creada exitosamente");
  abrirTab('solicitudes-tab');
  cargarSolicitudes();
}

async function cargarGerenciasSolicitudes(){
  const snapshot = await db.collection("gerencias").get();
  const sel = document.getElementById("solGerencia");
  const depSel = document.getElementById("depGerenciaSelect");
  sel.innerHTML='<option value="">Seleccione Gerencia</option>';
  depSel.innerHTML='<option value="">Seleccione Gerencia</option>';
  snapshot.forEach(doc=>{
    const d = doc.data();
    sel.innerHTML += `<option value="${d.nombre}">${d.nombre}</option>`;
    depSel.innerHTML += `<option value="${d.nombre}">${d.nombre}</option>`;
  });
}

async function cargarDepartamentosSolicitudes(){
  const snapshot = await db.collection("departamentos").get();
  const sel = document.getElementById("solDepartamento");
  sel.innerHTML='<option value="">Seleccione Departamento</option>';
  snapshot.forEach(doc=>{
    const d = doc.data();
    sel.innerHTML += `<option value="${d.nombre}">${d.nombre}</option>`;
  });
}
</script>
</body>
</html>
