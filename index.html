<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SGD - Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>

<!-- LOGIN -->
<div id="view-login" class="view">
  <div class="login-card">
    <h2>FCI | SGD</h2>
    <input id="logUser" type="email" placeholder="Email">
    <input id="logPass" type="password" placeholder="Contraseña">
    <button class="btn primary" onclick="handleLogin()">INGRESAR</button>

    <button class="btn secondary" id="btnCreateAdmin" onclick="crearAdmin()">CREAR ADMIN (solo 1 vez)</button>

    <p id="loginMsg"></p>
  </div>
</div>

<!-- APP -->
<div id="view-app" class="hidden">
  <header>
    <div class="logo">FCI | SGD</div>
    <div class="user-panel">
      <span id="userDisplay"></span>
      <button class="btn danger" onclick="logout()">Cerrar sesión</button>
    </div>
  </header>

  <nav class="tabs">
    <div class="tab active" data-tab="dash" onclick="switchTab('dash')">Dashboard</div>
    <div class="tab" data-tab="sol" onclick="switchTab('sol')">Solicitudes</div>
    <div class="tab admin hidden" data-tab="users" onclick="switchTab('users')">Usuarios</div>
    <div class="tab admin hidden" data-tab="org" onclick="switchTab('org')">Organización</div>
  </nav>

  <main class="content">

    <!-- DASHBOARD -->
    <section id="tab-dash" class="tab-content">
      <div class="grid">
        <div class="card stat">
          <h3>Total Solicitudes</h3>
          <div id="statTotal" class="statValue">0</div>
        </div>
        <div class="card stat">
          <h3>Pendientes</h3>
          <div id="statPend" class="statValue">0</div>
        </div>
        <div class="card stat">
          <h3>Aprobadas</h3>
          <div id="statApr" class="statValue">0</div>
        </div>
        <div class="card stat">
          <h3>Finalizadas</h3>
          <div id="statFin" class="statValue">0</div>
        </div>
      </div>

      <div class="card">
        <h2>Historial Completo</h2>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Título</th>
              <th>Estado</th>
              <th>Usuario</th>
              <th>Gerencia</th>
            </tr>
          </thead>
          <tbody id="historial"></tbody>
        </table>
      </div>
    </section>

    <!-- SOLICITUDES -->
    <section id="tab-sol" class="tab-content hidden">
      <div class="top">
        <h2>Solicitudes</h2>
        <button class="btn primary" onclick="openModal('modal-req')">+ Nueva Solicitud</button>
      </div>

      <div class="card">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Título</th>
              <th>Estado</th>
              <th>Gerencia</th>
              <th>Acción</th>
            </tr>
          </thead>
          <tbody id="tbody-sol"></tbody>
        </table>
      </div>
    </section>

    <!-- USUARIOS (ADMIN) -->
    <section id="tab-users" class="tab-content hidden">
      <div class="card">
        <h2>Usuarios</h2>
        <div class="form-grid">
          <input id="u-nom" placeholder="Nombre">
          <input id="u-email" placeholder="Email">
          <input id="u-pass" placeholder="Contraseña">
          <select id="u-rol">
            <option value="Solicitante">Solicitante</option>
            <option value="Gerente">Gerente</option>
            <option value="Admin">Admin</option>
          </select>
          <select id="u-ger"></select>
          <button class="btn primary" onclick="saveUser()">Crear Usuario</button>
        </div>
      </div>

      <div class="card">
        <table>
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Email</th>
              <th>Rol</th>
              <th>Gerencia</th>
              <th>Eliminar</th>
            </tr>
          </thead>
          <tbody id="tbody-users"></tbody>
        </table>
      </div>
    </section>

    <!-- ORGANIZACIÓN (ADMIN) -->
    <section id="tab-org" class="tab-content hidden">
      <div class="grid">
        <div class="card">
          <h3>Gerencias</h3>
          <div class="row">
            <input id="o-ger" placeholder="Nombre gerencia">
            <button class="btn primary" onclick="addOrg('gerencias','o-ger')">Agregar</button>
          </div>
          <ul id="list-ger"></ul>
        </div>

        <div class="card">
          <h3>Departamentos</h3>
          <select id="o-parent"></select>
          <div class="row">
            <input id="o-dep" placeholder="Nombre departamento">
            <button class="btn primary" onclick="addOrg('departamentos','o-dep','o-parent')">Agregar</button>
          </div>
          <ul id="list-dep"></ul>
        </div>
      </div>
    </section>

  </main>
</div>

<!-- MODAL -->
<div id="modal-req" class="modal hidden">
  <div class="modal-body">
    <h2>Nueva Solicitud</h2>
    <div class="form-grid">
      <input id="s-tit" placeholder="Título">
      <select id="s-tipo">
        <option>Procedimiento</option>
        <option>Manual</option>
        <option>Instructivo</option>
      </select>
      <select id="s-acc">
        <option>Creación</option>
        <option>Modificación</option>
      </select>
      <input id="s-ver" placeholder="Versión">
      <input id="s-fver" type="date">
      <select id="s-ger" onchange="loadDepsForForm(this.value)"></select>
      <select id="s-dep"></select>
      <textarea id="s-just" placeholder="Justificación"></textarea>
      <textarea id="s-desc" placeholder="Descripción"></textarea>
      <input id="s-file" type="file">
    </div>

    <div class="row">
      <button class="btn primary" onclick="submitSol()">Enviar</button>
      <button class="btn" onclick="closeModal()">Cerrar</button>
    </div>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>