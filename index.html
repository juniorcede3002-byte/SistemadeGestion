rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Colección de usuarios
    match /usuarios/{userId} {
      // Admin puede leer y escribir todo
      allow read, write: if request.resource.data.rol == "Admin" || request.auth == null;
      
      // Los demás no pueden modificar usuarios (excepto Admin)
      allow read: if true; 
      allow write: if false;
    }

    // Colección de gerencias
    match /gerencias/{gerenciaId} {
      // Solo admin puede crear/editar
      allow read: if true;
      allow write: if request.auth == null; // tu login sin auth
    }

    // Colección de departamentos
    match /departamentos/{departamentoId} {
      // Solo admin puede crear/editar
      allow read: if true;
      allow write: if request.auth == null; 
    }

    // Colección de solicitudes
    match /solicitudes/{solicitudId} {
      // Usuarios pueden leer sus propias solicitudes
      allow read: if request.resource.data.usuario == request.resource.data.usuario;
      // Gerentes pueden leer solicitudes de su gerencia
      allow read: if request.resource.data.gerencia == request.resource.data.gerencia;
      // Admin puede todo
      allow read, write: if request.auth == null; // login sin auth
      // Solo Admin puede eliminar
      allow delete: if request.auth == null;
      // Escritura de nuevos estados (comentarios)
      allow update: if true;
    }
  }
}